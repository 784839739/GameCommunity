<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>购物车</title>
<script type="text/javascript" src="../script/jquery.min.js"></script>
<script type="text/javascript" src="../script/jquerySession.js"></script>
<script type="text/javascript" src="../script/getRootPath.js"></script>
<script type="text/javascript" src="../script/getParam.js"></script>
<script type="text/javascript" src="../script/utils.js"></script>

<script type="text/javascript">
	var path = getRootPath(); 
</script>
</head>
<body>
<div><iframe align="center" width="100%" height="100" src="../top.html" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></div>

<br/>
	<table id="table" width=100%>
	<tr>
		<td id="gameName">游戏名</td>
		<td id="price">价格</td>
		<td id="cutOff">折扣</td>
		<td id="finalPrice">最终价格</td>
		<td id="operation">操作</td>
	</tr>
	<tr><td colspan="5"><hr/></td></tr>
	</table>
	
	<script type="text/javascript">
	var shoppingCart = $.session.get("shoppingCart");
	
	$(function(){
		if(shoppingCart == null || shoppingCart.length == 0 || shoppingCart == "undefined"){
			$("#table").append("<tr><td colspan='5'><center><h2>购物车中暂无商品，去<a href="+ path + 
					"/game/main.html>商店</a>逛逛？</h2></center></td></tr><tr><td colspan='5'><hr/></td></tr>");
			return;
		}
		$.ajax({
			url:"showGameShoppingCart.do",
			method:"POST",
			dataType:"JSON",
			data:{"shoppingCart": shoppingCart},
			success:function(result){
				console.log(result);
				createTable(result.data);
			}
		});
	});
	
	function createTable(data){
		for(var i = 0; i < data.length; i++){
			$("#table").append("<tr><td>" + data[i].gameName + "</td>" +
					"<td>" + data[i].price + "</td>" +
					"<td>" + data[i].cutOff + "</td>" + 
					"<td>" + (data[i].price * data[i].cutOff) + "</td>" + 
					"<td><a href=javascript:void() onclick=removeFromShoppingCart("+data[i].id +")>删除</a>" +
					"</tr><tr><td colspan='5'><hr/></td></tr>");
		}
		
	}
	
	function removeFromShoppingCart(gameId){
		$.session.set("shoppingCart", $.session.get("shoppingCart").replace(gameId+",", ""));
		window.location.href=path + "/game/showShoppingCart.html";
	}
	</script>
	
</body>
</html>